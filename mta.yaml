_schema-version: 3.3.0
ID: ansaldonuclear_dashboard
version: 1.0.0
description: "UI5 Application: integdashboard"
parameters:
  enable-parallel-deployments: true
  deploy_mode: html5-repo
build-parameters:
  before-all:
    - builder: custom
      commands:
        - npx cds build --production
modules:
  - name: integdashboard-destination-content
    type: com.sap.application.content
    requires:
    - name: integdashboard-destination-service
      parameters:
        content-target: true
    - name: integdashboard-repo-host
      parameters:
        service-key:
          name: integdashboard-repo-host-key
    - name: integdashboard-auth
      parameters:
        service-key:
          name: integdashboard-auth-key
    parameters:
      content:
        instance:
          destinations:
          - Name: integdashboard_html_repo_host
            ServiceInstanceName: integdashboard-html5-srv
            ServiceKeyName: integdashboard-repo-host-key
            sap.cloud.service: integdashboard
          - Authentication: OAuth2UserTokenExchange
            Name: integdashboard_uaa
            ServiceInstanceName: integdashboard-xsuaa-srv
            ServiceKeyName: integdashboard-auth-key
            sap.cloud.service: integdashboard
          existing_destinations_policy: ignore
    build-parameters:
      no-source: true
  - name: integdashboard-app-content
    type: com.sap.application.content
    path: .
    requires:
    - name: integdashboard-repo-host
      parameters:
        content-target: true
    build-parameters:
      build-result: resources
      requires:
      - artifacts:
        - integdashboard.zip
        name: integdashboard
        target-path: resources/
  - name:  integdashboard
    type: html5
    path: .
    build-parameters:
     build-result: dist
     builder: custom
     commands:
     - npm install
     - npm run build:cf
     supported-platforms: []

resources:
  - name: integdashboard-destination-service
    type: org.cloudfoundry.managed-service
    parameters:
      config:
        HTML5Runtime_enabled: true
        init_data:
          instance:
            destinations:
            - Authentication: NoAuthentication
              Name: ui5
              ProxyType: Internet
              Type: HTTP
              URL: https://ui5.sap.com
            existing_destinations_policy: update
        version: 1.0.0
      service: destination
      service-name: integdashboard-destination-service
      service-plan: lite
  - name: integdashboard-auth
    type: org.cloudfoundry.managed-service
    parameters:
      service: xsuaa
      service-name: integdashboard-xsuaa-srv
      service-plan: application
      path: ./xs-security.json
  - name: integdashboard-connectivity
    type: org.cloudfoundry.managed-service
    parameters:
      service: connectivity
      service-plan: lite
  - name: integdashboard-destination
    type: org.cloudfoundry.managed-service
    parameters:
      service: destination
      service-plan: lite

  - name: integdashboard-repo-host
    type: org.cloudfoundry.managed-service
    parameters:
      service: html5-apps-repo
      service-name: integdashboard-html5-srv
      service-plan: app-host
  - name: integdashboard-html5-runtime
    type: org.cloudfoundry.managed-service
    parameters:
      service: html5-apps-repo
      service-plan: app-runtime
